{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { clerkMiddleware, createRouteMatcher } from \"@clerk/nextjs/server\";\nimport { NextResponse } from 'next/server';\n\n// Define protected routes\nconst isProtectedRoute = createRouteMatcher([\n  '/dashboard(.*)',\n  '/create-agent',\n  '/agent(.*)',\n]);\n\n// Define public routes that don't require authentication\nconst isPublicRoute = (pathname: string) => {\n  return [\n    '/',\n    '/sign-in(.*)',\n    '/sign-up(.*)',\n    '/api/webhooks(.*)',\n    '/api/trpc(.*)',\n    '/_next(.*)',\n    '/favicon.ico',\n    '/(assets|images|fonts|icons)(.*)',\n  ].some(route => \n    pathname === route || \n    (route.endsWith('(.*)') && new RegExp(`^${route.replace('(.*)', '.*')}$`).test(pathname))\n  );\n};\n\nconst hasClerkEnv =\n  !!process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY &&\n  !!process.env.CLERK_SECRET_KEY;\n\n// If Clerk is not configured, bypass middleware to prevent 500s in production\nexport default (!hasClerkEnv\n  ? (async (_req: Request) => {\n      return NextResponse.next();\n    })\n  : clerkMiddleware(async (auth, req) => {\n  const { pathname } = req.nextUrl;\n  \n  // Skip middleware for public routes\n  if (isPublicRoute(pathname)) {\n    return NextResponse.next();\n  }\n\n  // Get the current session\n  const session = await auth();\n  \n  // Handle protected routes\n  if (isProtectedRoute(req)) {\n    // Check if user is signed in\n    const isSignedIn = session && \n                      'userId' in session && \n                      typeof session.userId === 'string' && \n                      session.userId.length > 0;\n    \n    // If user is not signed in, redirect to sign-in\n    if (!isSignedIn) {\n      const signInUrl = new URL('/sign-in', req.url);\n      signInUrl.searchParams.set('redirect_url', pathname);\n      return NextResponse.redirect(signInUrl);\n    }\n  }\n\n  // Add Convex auth headers to the request\n  const requestHeaders = new Headers(req.headers);\n  \n  // Type guard to check if session has getToken method\n  type SessionWithToken = {\n    getToken: (options?: { template?: string }) => Promise<string | null>;\n  };\n  \n  const hasGetToken = (s: unknown): s is SessionWithToken => {\n    return !!s && typeof s === 'object' && 'getToken' in s && typeof (s as { getToken: unknown }).getToken === 'function';\n  };\n\n  if (hasGetToken(session)) {\n    try {\n      const token = await session.getToken({ template: 'convex' });\n      if (token) {\n        requestHeaders.set('Authorization', `Bearer ${token}`);\n      }\n    } catch (error) {\n      console.error('Error getting auth token:', error);\n    }\n  }\n\n  return NextResponse.next({\n    request: {\n      headers: requestHeaders,\n    },\n  });\n}));\n\nexport const config = {\n  matcher: [\n    // Match all request paths except for the ones starting with:\n    // - _next/static (static files)\n    // - _next/image (image optimization files)\n    // - favicon.ico (favicon file)\n    // - files with extensions (e.g., .jpg, .css, .js)\n    '/((?!_next/static|_next/image|favicon.ico|.*[.].*).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEA,0BAA0B;AAC1B,MAAM,mBAAmB,CAAA,GAAA,kLAAA,CAAA,qBAAkB,AAAD,EAAE;IAC1C;IACA;IACA;CACD;AAED,yDAAyD;AACzD,MAAM,gBAAgB,CAAC;IACrB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD,CAAC,IAAI,CAAC,CAAA,QACL,aAAa,SACZ,MAAM,QAAQ,CAAC,WAAW,IAAI,OAAO,CAAC,CAAC,EAAE,MAAM,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC;AAEnF;AAEA,MAAM,cACJ,CAAC,gGACD,CAAC,CAAC,QAAQ,GAAG,CAAC,gBAAgB;uCAGhB,CAAC,cACZ,OAAO;IACN,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B,IACA,CAAA,GAAA,qLAAA,CAAA,kBAAe,AAAD,EAAE,OAAO,MAAM;IAC/B,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,oCAAoC;IACpC,IAAI,cAAc,WAAW;QAC3B,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,0BAA0B;IAC1B,MAAM,UAAU,MAAM;IAEtB,0BAA0B;IAC1B,IAAI,iBAAiB,MAAM;QACzB,6BAA6B;QAC7B,MAAM,aAAa,WACD,YAAY,WACZ,OAAO,QAAQ,MAAM,KAAK,YAC1B,QAAQ,MAAM,CAAC,MAAM,GAAG;QAE1C,gDAAgD;QAChD,IAAI,CAAC,YAAY;YACf,MAAM,YAAY,IAAI,IAAI,YAAY,IAAI,GAAG;YAC7C,UAAU,YAAY,CAAC,GAAG,CAAC,gBAAgB;YAC3C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,yCAAyC;IACzC,MAAM,iBAAiB,IAAI,QAAQ,IAAI,OAAO;IAO9C,MAAM,cAAc,CAAC;QACnB,OAAO,CAAC,CAAC,KAAK,OAAO,MAAM,YAAY,cAAc,KAAK,OAAO,AAAC,EAA4B,QAAQ,KAAK;IAC7G;IAEA,IAAI,YAAY,UAAU;QACxB,IAAI;YACF,MAAM,QAAQ,MAAM,QAAQ,QAAQ,CAAC;gBAAE,UAAU;YAAS;YAC1D,IAAI,OAAO;gBACT,eAAe,GAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE,OAAO;YACvD;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;QAC7C;IACF;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QACvB,SAAS;YACP,SAAS;QACX;IACF;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP,6DAA6D;QAC7D,gCAAgC;QAChC,2CAA2C;QAC3C,+BAA+B;QAC/B,kDAAkD;QAClD;KACD;AACH"}}]
}